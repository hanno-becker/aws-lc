// Copyright (c) 2022, ARM Inc.

// Permission to use, copy, modify, and/or distribute this software for any
// purpose with or without fee is hereby granted, provided that the above
// copyright notice and this permission notice appear in all copies.

// THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
// SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
// OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
// CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE. */

// Author: Hanno Becker <hannobecker@posteo.de>

// This file was derived from the assembly generated from aesv8-gcm-armv8.pl,
// written by Fangming Fang <fangming.fang@arm.com> for the OpenSSL project,
// and derived from https: // github.com/ARM-software/AArch64cryptolib, original
// author Samuel Lee <Samuel.Lee@arm.com>.

// The code below is a 'clean' AArch64 implementation of AES-GCM emphasizing
// the logic of the computation. It is meant as the input to manual audits /
// formal verification, as well as automated micro-optimization such as done
// by the SLOTHY superoptimizer (https: // github.com/slothy-optimizer/slothy).

#if !defined(__has_feature)
#define __has_feature(x) 0
#endif
#if __has_feature(memory_sanitizer) && !defined(OPENSSL_NO_ASM)
#define OPENSSL_NO_ASM
#endif

#include <openssl/asm_base.h>

#if !defined(OPENSSL_NO_ASM) && defined(__AARCH64EL__)
#if defined(__ELF__)
#include <openssl/boringssl_prefix_symbols_asm.h>
#include <openssl/arm_arch.h>
.arch   armv8-a+crypto
.text
.globl  aes_gcm_enc_kernel_slothy_base_128
.hidden aes_gcm_enc_kernel_slothy_base_128
.type   aes_gcm_enc_kernel_slothy_base_128,%function
#elif defined(__APPLE__)
#if defined(BORINGSSL_PREFIX)
#include <boringssl_prefix_symbols_asm.h>
#endif
#include <openssl/arm_arch.h>
.text
.globl	_aes_gcm_enc_kernel_slothy_base_128
.private_extern	_aes_gcm_enc_kernel_slothy_base_128
#else
#error Unknown configuration
#endif

#if __ARM_MAX_ARCH__ >= 8

// Arguments
input    .req x0
len_bits .req x1
output   .req x2
tag_ptr  .req x3
ivec     .req x4
key      .req x5
Htable   .req x6

byte_len .req x15

constant_temp .req x25

count           .req x1
full_blocks     .req x7
remainder       .req x9
unroll          .req x10

aes_st0   .req v0
aes_st0_q .req q0
aes_st1   .req v1
aes_st1_q .req q1
aes_st2   .req v2
aes_st2_q .req q2
aes_st3   .req v3
aes_st3_q .req q3
aes_st4   .req v20
aes_st4_q .req q20
aes_st5   .req v21
aes_st5_q .req q21
aes_st6   .req v22
aes_st6_q .req q22
aes_st7   .req v23
aes_st7_q .req q23

res0      .req v4
res0_q    .req q4
res1      .req v5
res1_q    .req q5
res2      .req v6
res2_q    .req q6
res3      .req v24
res3_q    .req q24
res4      .req v25
res4_q    .req q25
res5      .req v26
res5_q    .req q26
res6      .req v27
res6_q    .req q27
res7      .req v28
res7_q    .req q28

ghash_hi    .req v9
ghash_lo    .req v8
ghash_mid   .req v10

ghash_hi0   .req ghash_hi
ghash_lo0   .req ghash_lo
ghash_mid0  .req ghash_mid

ghash_hi1    .req v15
ghash_lo1    .req v16
ghash_mid1   .req v17

ghash_tmp   .req v11
ghash_tmp_d .req d11

ghash_mod   .req v7
ghash_mod_d .req d7

modulo_tmp0 .req v0
modulo_tmp1 .req v1

Ht1q    .req q12
Ht2q    .req q13
Ht12q   .req q14

Ht1    .req v12
Ht2    .req v13
Ht12   .req v14

Ht3q    .req Ht1q
Ht4q    .req Ht2q
Ht34q   .req Ht12q

Ht3    .req Ht1
Ht4    .req Ht2
Ht34   .req Ht12

Ht5q    .req Ht1q
Ht6q    .req Ht2q
Ht56q   .req Ht12q

Ht5    .req Ht1
Ht6    .req Ht2
Ht56   .req Ht12

Ht7q    .req Ht1q
Ht8q    .req Ht2q
Ht78q   .req Ht12q

Ht7    .req Ht1
Ht8    .req Ht2
Ht78   .req Ht12

rk0q   .req q18
rk1q   .req q19
rk2q   .req q18 // q20
rk3q   .req q19 // q21
rk4q   .req q18 // q22
rk5q   .req q19 // q23
rk6q   .req q18 // q24
rk7q   .req q19 // q25
rk8q   .req q18 // q26
rk9q   .req q19 // q27
rk10q  .req q18 // q28

rk0    .req v18
rk1    .req v19
rk2    .req v18 // v20
rk3    .req v19 // v21
rk4    .req v18 // v22
rk5    .req v19 // v23
rk6    .req v18 // v24
rk7    .req v19 // v25
rk8    .req v18 // v26
rk9    .req v19 // v27
rk10   .req v18 // v28

plain0   .req res0
plain0_q .req res0_q
plain1   .req res1
plain1_q .req res1_q
plain2   .req res2
plain2_q .req res2_q
plain3   .req res3
plain3_q .req res3_q
plain4   .req res4
plain4_q .req res4_q
plain5   .req res5
plain5_q .req res5_q
plain6   .req res6
plain6_q .req res6_q
plain7   .req res7
plain7_q .req res7_q

rctr_inc   .req v30
rtmp_ctr   .req v31
rtmp_ctr_q .req q31

tag    .req v11
tag_q  .req q11

#define UNROLL 8

#define STACK_SIZE_GPRS  (6*16)
#define STACK_SIZE_VREGS (4*16)
#define STACK_SIZE  (STACK_SIZE_GPRS + STACK_SIZE_VREGS)

#define STACK_BASE_GPRS  (0)
#define STACK_BASE_VREGS (STACK_SIZE_GPRS)

/********************************************************************/
/*                 Generic preamble/postamble macros                */
/********************************************************************/

.macro save_vregs
        stp  d8,  d9, [sp, #(STACK_BASE_VREGS + 16*0)]
        stp d10, d11, [sp, #(STACK_BASE_VREGS + 16*1)]
        stp d12, d13, [sp, #(STACK_BASE_VREGS + 16*2)]
        stp d14, d15, [sp, #(STACK_BASE_VREGS + 16*3)]
.endm

.macro restore_vregs
        ldp  d8,  d9, [sp, #(STACK_BASE_VREGS + 16*0)]
        ldp d10, d11, [sp, #(STACK_BASE_VREGS + 16*1)]
        ldp d12, d13, [sp, #(STACK_BASE_VREGS + 16*2)]
        ldp d14, d15, [sp, #(STACK_BASE_VREGS + 16*3)]
.endm

.macro save_gprs
        stp x19, x20, [sp, #(STACK_BASE_GPRS + 16*0)]
        stp x21, x22, [sp, #(STACK_BASE_GPRS + 16*1)]
        stp x23, x24, [sp, #(STACK_BASE_GPRS + 16*2)]
        stp x25, x26, [sp, #(STACK_BASE_GPRS + 16*3)]
        stp x27, x28, [sp, #(STACK_BASE_GPRS + 16*4)]
        stp x29, x30, [sp, #(STACK_BASE_GPRS + 16*5)]
.endm

.macro restore_gprs
        ldp x19, x20, [sp, #(STACK_BASE_GPRS + 16*0)]
        ldp x21, x22, [sp, #(STACK_BASE_GPRS + 16*1)]
        ldp x23, x24, [sp, #(STACK_BASE_GPRS + 16*2)]
        ldp x25, x26, [sp, #(STACK_BASE_GPRS + 16*3)]
        ldp x27, x28, [sp, #(STACK_BASE_GPRS + 16*4)]
        ldp x29, x30, [sp, #(STACK_BASE_GPRS + 16*5)]
.endm

.macro prepare_loop_counts
        mov  unroll, #UNROLL
        lsr  full_blocks, byte_len, #4
        udiv count, full_blocks, unroll
        msub remainder, count, unroll, full_blocks
.endm

/********************************************************************/
/*                       AES related macros                         */
/********************************************************************/

.macro load_iv
        ldr     rtmp_ctr_q, [ivec]

 mov	constant_temp, #0x100000000   // set up counter increment
 movi	rctr_inc.16b,  #0x0
 fmov	rctr_inc.d[1], constant_temp

        rev32   rtmp_ctr.16b, rtmp_ctr.16b
.endm

.macro aes_ctr_inc
        add    rtmp_ctr.4s, rtmp_ctr.4s, rctr_inc.4s
.endm

.macro next_ctr_init_aes aes_st
        rev32  \aes_st\().16b, rtmp_ctr.16b
        aes_ctr_inc
.endm

.macro next_ctr_init_aes_x8 aes_st
        next_ctr_init_aes \aes_st\()0
        next_ctr_init_aes \aes_st\()1
        next_ctr_init_aes \aes_st\()2
        next_ctr_init_aes \aes_st\()3
        next_ctr_init_aes \aes_st\()4
        next_ctr_init_aes \aes_st\()5
        next_ctr_init_aes \aes_st\()6
        next_ctr_init_aes \aes_st\()7
.endm

// Prevent SLOTHY from unfolding because uArchs tend to fuse AESMC+AESE
.macro aesr data, key // @slothy:no-unfold
        aese  \data, \key
        aesmc \data, \data
.endm


.macro aesr_x4 st0, st1, st2, st3, rk // @slothy:no-unfold
        aesr \st0, \rk
        aesr \st1, \rk
        aesr \st2, \rk
        aesr \st3, \rk
.endm

.macro aese_x4 st0, st1, st2, st3, rk // @slothy:no-unfold
        aese \st0, \rk
        aese \st1, \rk
        aese \st2, \rk
        aese \st3, \rk
.endm

.macro aesr_x8 i
        load_round_key \i
        aesr_x4 aes_st0.16b, aes_st1.16b, aes_st2.16b, aes_st3.16b, rk\i\().16b
        aesr_x4 aes_st4.16b, aes_st5.16b, aes_st6.16b, aes_st7.16b, rk\i\().16b
.endm

.macro aese_x8 i
        load_round_key \i
        aese_x4 aes_st0.16b, aes_st1.16b, aes_st2.16b, aes_st3.16b, rk\i\().16b
        aese_x4 aes_st4.16b, aes_st5.16b, aes_st6.16b, aes_st7.16b, rk\i\().16b
.endm

.macro aesr_final aes_st, plain, out
        aese \aes_st\().16b, rk9.16b
        eor3 \out\().16b, \plain\().16b, rk10.16b, \aes_st\().16b
.endm

// Load i-th round key
.macro load_round_key i
        ldr rk\i\()q, [key, #((\i)*16)]
.endm

.macro load_round_keys
        load_round_key 0
        load_round_key 1
        load_round_key 2
        load_round_key 3
        load_round_key 4
        load_round_key 5
        load_round_key 6
        load_round_key 7
        load_round_key 8
        load_round_key 9
        load_round_key 10
.endm

/********************************************************************/
/*       Loading of H-table (precomputed H-powers for GHASH)        */
/********************************************************************/

// This has to be synchronized with the H-table generation

.macro load_h1 dst, dst_q
        ldr \dst_q, [Htable]
.endm

.macro load_h2 dst, dst_q
        ldr \dst_q, [Htable, #32]
.endm

.macro load_h3 dst, dst_q
        ldr \dst_q, [Htable, #48]
.endm

.macro load_h4 dst, dst_q
        ldr \dst_q, [Htable, #80]
.endm

.macro load_h5 dst, dst_q
        ldr \dst_q, [Htable, #96]
.endm

.macro load_h6 dst, dst_q
        ldr \dst_q, [Htable, #128]
.endm

.macro load_h7 dst, dst_q
        ldr \dst_q, [Htable, #144]
.endm

.macro load_h8 dst, dst_q
        ldr \dst_q, [Htable, #176]
.endm

.macro load_h12 dst, dst_q
        ldr \dst_q, [Htable, #16]
.endm

.macro load_h34 dst, dst_q
        ldr \dst_q, [Htable, #64]
.endm

.macro load_h56 dst, dst_q
        ldr \dst_q, [Htable, #112]
.endm

.macro load_h78 dst, dst_q
        ldr \dst_q, [Htable, #160]
.endm

.macro load_full_htable
        load_h1  Ht1,  Ht1q
        load_h2  Ht2,  Ht2q
        load_h3  Ht3,  Ht3q
        load_h4  Ht4,  Ht4q
        load_h5  Ht5,  Ht5q
        load_h6  Ht6,  Ht6q
        load_h12 Ht12, Ht12q
        load_h34 Ht34, Ht34q
        load_h56 Ht56, Ht56q
.endm

.macro load_htable_12
        load_h1  Ht1,  Ht1q
        load_h2  Ht2,  Ht2q
        load_h12 Ht12, Ht12q
.endm

.macro load_htable_34
        load_h3  Ht3,  Ht3q
        load_h4  Ht4,  Ht4q
        load_h34 Ht34, Ht34q
.endm

.macro load_htable_56
        load_h5  Ht5,  Ht5q
        load_h6  Ht6,  Ht6q
        load_h56 Ht56, Ht56q
.endm

.macro load_htable_78
        load_h7  Ht7,  Ht7q
        load_h8  Ht8,  Ht8q
        load_h78 Ht78, Ht78q
.endm

/********************************************************************/
/*                    Macros for GHASH udpate                       */
/********************************************************************/

.macro ghash_init_pair inputa, inputb, Ha, Hb, Hk_mid, i
        // Low product
        pmull   ghash_lo\i\().1q,  \inputa\().1d, \Ha\().1d
        pmull   ghash_tmp.1q, \inputb\().1d, \Hb\().1d
        eor     ghash_lo\i\().16b, ghash_lo\i\().16b, ghash_tmp.16b
        // High product
        pmull2  ghash_hi\i\().1q, \inputa\().2d, \Ha\().2d
        pmull2  ghash_tmp.1q, \inputb\().2d, \Hb\().2d
        eor     ghash_hi\i\().16b, ghash_hi\i\().16b, ghash_tmp.16b
        // Middle product
        trn1    ghash_tmp.2d,  \inputb\().2d, \inputa\().2d
        trn2    \inputb\().2d, \inputb\().2d, \inputa\().2d
        eor     ghash_tmp.16b, ghash_tmp.16b, \inputb\().16b
        pmull2  ghash_mid\i\().1q, ghash_tmp.2d, \Hk_mid\().2d
        pmull   ghash_tmp.1q, ghash_tmp.1d, \Hk_mid\().1d
        eor     ghash_mid\i\().16b, ghash_mid\i\().16b, ghash_tmp.16b
.endm

.macro ghash_acc_pair inputa, inputb, Ha, Hb, Hk_mid, i
        // Low product
        pmull   ghash_tmp.1q, \inputa\().1d, \Ha\().1d
        eor     ghash_lo\i\().16b, ghash_lo\i\().16b, ghash_tmp.16b
        pmull   ghash_tmp.1q, \inputb\().1d, \Hb\().1d
        eor     ghash_lo\i\().16b, ghash_lo\i\().16b, ghash_tmp.16b
        // High product
        pmull2  ghash_tmp.1q, \inputa\().2d, \Ha\().2d
        eor     ghash_hi\i\().16b, ghash_hi\i\().16b, ghash_tmp.16b
        pmull2  ghash_tmp.1q, \inputb\().2d, \Hb\().2d
        eor     ghash_hi\i\().16b, ghash_hi\i\().16b, ghash_tmp.16b
        // Middle product
        trn1    ghash_tmp.2d,  \inputb\().2d, \inputa\().2d
        trn2    \inputb\().2d, \inputb\().2d, \inputa\().2d
        eor     ghash_tmp.16b, ghash_tmp.16b, \inputb\().16b
        pmull2  \inputa\().1q, ghash_tmp.2d, \Hk_mid\().2d
        eor     ghash_mid\i\().16b, ghash_mid\i\().16b, \inputa\().16b
        pmull   ghash_tmp.1q, ghash_tmp.1d, \Hk_mid\().1d
        eor     ghash_mid\i\().16b, ghash_mid\i\().16b, ghash_tmp.16b
.endm

.macro ghash_init_0 input, Hk, Hk_mid, tag
        rev64 \input\().16b, \input\().16b
        eor   \input\().16b, \input\().16b, \tag\().16b
        // Low product
        pmull   ghash_lo.1q, \input\().1d, \Hk\().1d
        // High product
        pmull2  ghash_hi.1q, \input\().2d, \Hk\().2d
        // Middle product
        mov     ghash_tmp_d, \input\().d[1]
        eor     ghash_tmp.8b, ghash_tmp.8b, \input\().8b
        pmull   ghash_mid.1q, ghash_tmp.1d, \Hk_mid\().1d
.endm

.macro ghash_init_1 input, Hk, Hk_mid, tag
        rev64 \input\().16b, \input\().16b
        eor   \input\().16b, \input\().16b, \tag\().16b
        // Low product
        pmull   ghash_lo.1q, \input\().1d, \Hk\().1d
        // High product
        pmull2  ghash_hi.1q, \input\().2d, \Hk\().2d
        // Middle product
        ext     ghash_tmp.16b, \input\().16b, \input\().16b, #8
        eor     ghash_tmp.16b, ghash_tmp.16b, \input\().16b
        pmull2  ghash_mid.1q, ghash_tmp.2d, \Hk_mid\().2d
.endm

.macro ghash_finalize tag
        eor        modulo_tmp0.16b, ghash_lo.16b,  ghash_hi.16b
        pmull      modulo_tmp1.1q,  ghash_hi.1d,   ghash_mod.1d
        ext        ghash_hi.16b,    ghash_hi.16b,  ghash_hi.16b, #8
        eor        ghash_mid.16b,   ghash_mid.16b, modulo_tmp0.16b
        eor        modulo_tmp1.16b, ghash_hi.16b,  modulo_tmp1.16b
        eor        ghash_mid.16b,   ghash_mid.16b, modulo_tmp1.16b
        pmull      ghash_hi.1q,     ghash_mid.1d,  ghash_mod.1d
        eor        ghash_lo.16b,    ghash_lo.16b,  ghash_hi.16b
        ext        ghash_mid.16b,   ghash_mid.16b, ghash_mid.16b, #8
        eor        \tag\().16b,     ghash_lo.16b,  ghash_mid.16b
        ext        \tag\().16b, \tag\().16b, \tag\().16b, #8
.endm

.macro store_0_8 res
        stp \res\()0_q, \res\()1_q, [output], #(8*16)
        stp \res\()2_q, \res\()3_q, [output, #(-6*16)]
        stp \res\()4_q, \res\()5_q, [output, #(-4*16)]
        stp \res\()6_q, \res\()7_q, [output, #(-2*16)]
        rev64 \res\()0.16b, \res\()0.16b
        rev64 \res\()1.16b, \res\()1.16b
        rev64 \res\()2.16b, \res\()2.16b
        rev64 \res\()3.16b, \res\()3.16b
        rev64 \res\()4.16b, \res\()4.16b
        rev64 \res\()5.16b, \res\()5.16b
        rev64 \res\()6.16b, \res\()6.16b
        rev64 \res\()7.16b, \res\()7.16b
.endm

.macro load_tag
        ldr      tag_q, [tag_ptr]
        rev64    tag.16b, tag.16b
.endm

.macro prepare_ghash
        // Prepare constant for modular reduction
        movi ghash_mod.8b, #0xc2
        shl  ghash_mod_d, ghash_mod_d, #56
.endm

/********************************************************************/
/*                            Core routine                          */
/********************************************************************/

.align        4
_aes_gcm_enc_kernel_slothy_base_128:
aes_gcm_enc_kernel_slothy_base_128:
#ifdef BORINGSSL_DISPATCH_TEST
        adrp  x9,_BORINGSSL_function_hit@PAGE
        add   x9, x9, _BORINGSSL_function_hit@PAGEOFF
        mov   w10, #1
        strb  w10, [x9,#2] // kFlag_aes_gcm_enc_kernel
#endif

        AARCH64_SIGN_LINK_REGISTER
        sub sp, sp, #STACK_SIZE

Lenc_preamble_start:
        save_gprs
        save_vregs

        lsr byte_len, len_bits, #3

        load_tag
        load_iv

        prepare_loop_counts
        prepare_ghash

Lenc_preamble_end:

        cbz count, Lloop_unrolled_end
        // Instructions:    0
        // Expected cycles: 0
        // Expected IPC:    0
cbz count, Lloop_unrolled_start_postamble
Lloop_unrolled_start:
        // Instructions:    152
        // Expected cycles: 26
        // Expected IPC:    5.846153846153846
        // gap                                                     // ........................................................................................................................................................
        // gap                                                     // ........................................................................................................................................................
        // gap                                                     // ........................................................................................................................................................
        // gap                                                     // ........................................................................................................................................................
        add v28.4S, v31.4S, v30.4S                                 // .*......................................................................................................................................................
        rev32 v15.16B, v31.16B                                     // *.......................................................................................................................................................
        rev32 v20.16B, v28.16B                                     // ..*.....................................................................................................................................................
        add v31.4S, v28.4S, v30.4S                                 // ...*....................................................................................................................................................
        rev32 v12.16B, v31.16B                                     // ....*...................................................................................................................................................
        add v31.4S, v31.4S, v30.4S                                 // .....*..................................................................................................................................................
        rev32 v29.16B, v31.16B                                     // ......*.................................................................................................................................................
        add v31.4S, v31.4S, v30.4S                                 // .......*................................................................................................................................................
        rev32 v13.16B, v31.16B                                     // ........*...............................................................................................................................................
        add v31.4S, v31.4S, v30.4S                                 // .........*..............................................................................................................................................
        rev32 v8.16B, v31.16B                                      // ..........*.............................................................................................................................................
        add v31.4S, v31.4S, v30.4S                                 // ...........*............................................................................................................................................
        rev32 v0.16B, v31.16B                                      // ............*...........................................................................................................................................
        add v31.4S, v31.4S, v30.4S                                 // .............*..........................................................................................................................................
        rev32 v4.16B, v31.16B                                      // ..............*.........................................................................................................................................
        add v31.4S, v31.4S, v30.4S                                 // ...............*........................................................................................................................................
        ldr q14, [x5, #0]                                          // ................*.......................................................................................................................................
        aesr_x4 v15.16b, v20.16b, v12.16b, v29.16b, v14.16b        // .................*......................................................................................................................................
        aesr_x4 v13.16b, v8.16b, v0.16b, v4.16b, v14.16b           // ..................*.....................................................................................................................................
        ldr q26, [x5, #16]                                         // ...................*....................................................................................................................................
        aesr_x4 v15.16b, v20.16b, v12.16b, v29.16b, v26.16b        // ....................*...................................................................................................................................
        aesr_x4 v13.16b, v8.16b, v0.16b, v4.16b, v26.16b           // .....................*..................................................................................................................................
        ldr q1, [x5, #32]                                          // ......................*.................................................................................................................................
        aesr_x4 v15.16b, v20.16b, v12.16b, v29.16b, v1.16b         // .......................*................................................................................................................................
        aesr_x4 v13.16b, v8.16b, v0.16b, v4.16b, v1.16b            // ........................*...............................................................................................................................
        ldr q1, [x5, #48]                                          // .........................*..............................................................................................................................
        aesr_x4 v15.16b, v20.16b, v12.16b, v29.16b, v1.16b         // ..........................*.............................................................................................................................
        aesr_x4 v13.16b, v8.16b, v0.16b, v4.16b, v1.16b            // ...........................*............................................................................................................................
        ldr q21, [x5, #64]                                         // ............................*...........................................................................................................................
        aesr_x4 v15.16b, v20.16b, v12.16b, v29.16b, v21.16b        // .............................*..........................................................................................................................
        aesr_x4 v13.16b, v8.16b, v0.16b, v4.16b, v21.16b           // ..............................*.........................................................................................................................
        ldr q27, [x5, #80]                                         // ...............................*........................................................................................................................
        aesr_x4 v15.16b, v20.16b, v12.16b, v29.16b, v27.16b        // ................................*.......................................................................................................................
        aesr_x4 v13.16b, v8.16b, v0.16b, v4.16b, v27.16b           // .................................*......................................................................................................................
        ldr q6, [x5, #96]                                          // ..................................*.....................................................................................................................
        aesr_x4 v15.16b, v20.16b, v12.16b, v29.16b, v6.16b         // ...................................*....................................................................................................................
        aesr_x4 v13.16b, v8.16b, v0.16b, v4.16b, v6.16b            // ....................................*...................................................................................................................
        ldr q22, [x5, #112]                                        // .....................................*..................................................................................................................
        aesr_x4 v15.16b, v20.16b, v12.16b, v29.16b, v22.16b        // ......................................*.................................................................................................................
        aesr_x4 v13.16b, v8.16b, v0.16b, v4.16b, v22.16b           // .......................................*................................................................................................................
        ldr q2, [x5, #128]                                         // ........................................*...............................................................................................................
        aesr_x4 v15.16b, v20.16b, v12.16b, v29.16b, v2.16b         // .........................................*..............................................................................................................
        aesr_x4 v13.16b, v8.16b, v0.16b, v4.16b, v2.16b            // ..........................................*.............................................................................................................
        ldr q25, [x5, #144]                                        // ...........................................*............................................................................................................
        aese_x4 v15.16b, v20.16b, v12.16b, v29.16b, v25.16b        // ............................................*...........................................................................................................
        aese_x4 v13.16b, v8.16b, v0.16b, v4.16b, v25.16b           // .............................................*..........................................................................................................
        ldr q27, [x5, #160]                                        // ..............................................*.........................................................................................................
        ldp q23, q16, [x0], #(8*16)                                // ...............................................*........................................................................................................
        eor3 v6.16B, v23.16B, v27.16B, v15.16B                     // ................................................*.......................................................................................................
        eor3 v22.16B, v16.16B, v27.16B, v20.16B                    // .................................................*......................................................................................................
        ldp q16, q15, [x0, #-96]                                   // ..................................................*.....................................................................................................
        eor3 v2.16B, v16.16B, v27.16B, v12.16B                     // ...................................................*....................................................................................................
        eor3 v25.16B, v15.16B, v27.16B, v29.16B                    // ....................................................*...................................................................................................
        ldp q16, q15, [x0, #-64]                                   // .....................................................*..................................................................................................
        eor3 v19.16B, v16.16B, v27.16B, v13.16B                    // ......................................................*.................................................................................................
        eor3 v18.16B, v15.16B, v27.16B, v8.16B                     // .......................................................*................................................................................................
        ldp q16, q15, [x0, #-32]                                   // ........................................................*...............................................................................................
        eor3 v23.16B, v16.16B, v27.16B, v0.16B                     // .........................................................*..............................................................................................
        eor3 v16.16B, v15.16B, v27.16B, v4.16B                     // ..........................................................*.............................................................................................
        stp q6, q22, [x2], #(8*16)                                 // ...........................................................*............................................................................................
        stp q2, q25, [x2, #-96]                                    // ............................................................*...........................................................................................
        stp q19, q18, [x2, #-64]                                   // .............................................................*..........................................................................................
        stp q23, q16, [x2, #-32]                                   // ..............................................................*.........................................................................................
        rev64 v15.16B, v6.16B                                      // ...............................................................*........................................................................................
        rev64 v3.16B, v22.16B                                      // ................................................................*.......................................................................................
        rev64 v21.16B, v2.16B                                      // .................................................................*......................................................................................
        rev64 v27.16B, v25.16B                                     // ..................................................................*.....................................................................................
        rev64 v5.16B, v19.16B                                      // ...................................................................*....................................................................................
        rev64 v17.16B, v18.16B                                     // ....................................................................*...................................................................................
        rev64 v14.16B, v23.16B                                     // .....................................................................*..................................................................................
        rev64 v26.16B, v16.16B                                     // ......................................................................*.................................................................................
        eor v2.16B, v15.16B, v11.16B                               // .......................................................................*................................................................................
        ldr q25, [x6, #144]                                        // ........................................................................*...............................................................................
        ldr q23, [x6, #176]                                        // .........................................................................*..............................................................................
        ldr q18, [x6, #160]                                        // ..........................................................................*.............................................................................
        pmull v16.1q, v2.1d, v23.1d                                // ...........................................................................*............................................................................
        pmull v15.1q, v3.1d, v25.1d                                // ............................................................................*...........................................................................
        eor v6.16B, v16.16B, v15.16B                               // .............................................................................*..........................................................................
        pmull2 v23.1q, v2.2d, v23.2d                               // ..............................................................................*.........................................................................
        pmull2 v15.1q, v3.2d, v25.2d                               // ...............................................................................*........................................................................
        trn1 v16.2D, v3.2D, v2.2D                                  // .................................................................................*......................................................................
        eor v22.16B, v23.16B, v15.16B                              // ................................................................................*.......................................................................
        trn2 v15.2D, v3.2D, v2.2D                                  // ..................................................................................*.....................................................................
        eor v15.16B, v16.16B, v15.16B                              // ...................................................................................*....................................................................
        pmull2 v16.1q, v15.2d, v18.2d                              // ....................................................................................*...................................................................
        pmull v15.1q, v15.1d, v18.1d                               // .....................................................................................*..................................................................
        eor v2.16B, v16.16B, v15.16B                               // ......................................................................................*.................................................................
        ldr q25, [x6, #96]                                         // .......................................................................................*................................................................
        ldr q18, [x6, #128]                                        // ........................................................................................*...............................................................
        ldr q23, [x6, #112]                                        // .........................................................................................*..............................................................
        pmull v16.1q, v21.1d, v18.1d                               // ..........................................................................................*.............................................................
        pmull v15.1q, v27.1d, v25.1d                               // ...........................................................................................*............................................................
        eor v1.16B, v16.16B, v15.16B                               // ............................................................................................*...........................................................
        pmull2 v16.1q, v21.2d, v18.2d                              // .............................................................................................*..........................................................
        pmull2 v15.1q, v27.2d, v25.2d                              // ..............................................................................................*.........................................................
        eor v3.16B, v16.16B, v15.16B                               // ...............................................................................................*........................................................
        trn1 v16.2D, v27.2D, v21.2D                                // ................................................................................................*.......................................................
        trn2 v15.2D, v27.2D, v21.2D                                // .................................................................................................*......................................................
        eor v15.16B, v16.16B, v15.16B                              // ..................................................................................................*.....................................................
        pmull2 v16.1q, v15.2d, v23.2d                              // ...................................................................................................*....................................................
        pmull v15.1q, v15.1d, v23.1d                               // ....................................................................................................*...................................................
        eor v21.16B, v16.16B, v15.16B                              // .....................................................................................................*..................................................
        ldr q25, [x6, #48]                                         // ......................................................................................................*.................................................
        ldr q23, [x6, #80]                                         // .......................................................................................................*................................................
        ldr q18, [x6, #64]                                         // ........................................................................................................*...............................................
        pmull v15.1q, v5.1d, v23.1d                                // .........................................................................................................*..............................................
        eor v16.16B, v6.16B, v15.16B                               // ..........................................................................................................*.............................................
        pmull v15.1q, v17.1d, v25.1d                               // ...........................................................................................................*............................................
        eor v27.16B, v16.16B, v15.16B                              // ............................................................................................................*...........................................
        pmull2 v15.1q, v5.2d, v23.2d                               // .............................................................................................................*..........................................
        eor v16.16B, v22.16B, v15.16B                              // ..............................................................................................................*.........................................
        pmull2 v15.1q, v17.2d, v25.2d                              // ...............................................................................................................*........................................
        eor v6.16B, v16.16B, v15.16B                               // ................................................................................................................*.......................................
        trn1 v16.2D, v17.2D, v5.2D                                 // .................................................................................................................*......................................
        trn2 v15.2D, v17.2D, v5.2D                                 // ..................................................................................................................*.....................................
        eor v23.16B, v16.16B, v15.16B                              // ...................................................................................................................*....................................
        pmull2 v15.1q, v23.2d, v18.2d                              // ....................................................................................................................*...................................
        eor v16.16B, v2.16B, v15.16B                               // .....................................................................................................................*..................................
        pmull v15.1q, v23.1d, v18.1d                               // ......................................................................................................................*.................................
        eor v22.16B, v16.16B, v15.16B                              // .......................................................................................................................*................................
        ldr q2, [x6]                                               // ........................................................................................................................*...............................
        ldr q16, [x6, #32]                                         // .........................................................................................................................*..............................
        ldr q25, [x6, #16]                                         // ..........................................................................................................................*.............................
        pmull v15.1q, v14.1d, v16.1d                               // ...........................................................................................................................*............................
        eor v18.16B, v1.16B, v15.16B                               // ............................................................................................................................*...........................
        pmull v23.1q, v26.1d, v2.1d                                // .............................................................................................................................*..........................
        pmull2 v15.1q, v14.2d, v16.2d                              // ...............................................................................................................................*........................
        eor v16.16B, v3.16B, v15.16B                               // ................................................................................................................................*.......................
        eor v18.16B, v18.16B, v23.16B                              // ..............................................................................................................................*.........................
        pmull2 v15.1q, v26.2d, v2.2d                               // .................................................................................................................................*......................
        eor v23.16B, v16.16B, v15.16B                              // ..................................................................................................................................*.....................
        trn1 v16.2D, v26.2D, v14.2D                                // ...................................................................................................................................*....................
        trn2 v15.2D, v26.2D, v14.2D                                // ....................................................................................................................................*...................
        eor v15.16B, v16.16B, v15.16B                              // .....................................................................................................................................*..................
        pmull2 v16.1q, v15.2d, v25.2d                              // ......................................................................................................................................*.................
        pmull v15.1q, v15.1d, v25.1d                               // ........................................................................................................................................*...............
        eor v16.16B, v21.16B, v16.16B                              // .......................................................................................................................................*................
        eor v16.16B, v16.16B, v15.16B                              // .........................................................................................................................................*..............
        eor v25.16B, v27.16B, v18.16B                              // ..........................................................................................................................................*.............
        eor v15.16B, v6.16B, v23.16B                               // ...........................................................................................................................................*............
        eor v18.16B, v22.16B, v16.16B                              // ............................................................................................................................................*...........
        eor v16.16B, v25.16B, v15.16B                              // .............................................................................................................................................*..........
        pmull v23.1q, v15.1d, v7.1d                                // ..............................................................................................................................................*.........
        ext v15.16B, v15.16B, v15.16B, #8                          // ...............................................................................................................................................*........
        eor v16.16B, v18.16B, v16.16B                              // ................................................................................................................................................*.......
        eor v15.16B, v15.16B, v23.16B                              // .................................................................................................................................................*......
        eor v23.16B, v16.16B, v15.16B                              // ..................................................................................................................................................*.....
        pmull v15.1q, v23.1d, v7.1d                                // ...................................................................................................................................................*....
        eor v16.16B, v25.16B, v15.16B                              // ....................................................................................................................................................*...
        ext v15.16B, v23.16B, v23.16B, #8                          // .....................................................................................................................................................*..
        eor v15.16B, v16.16B, v15.16B                              // ......................................................................................................................................................*.
        ext v11.16B, v15.16B, v15.16B, #8                          // .......................................................................................................................................................*

        // original source code
        // rev32  v0.16b, v31.16b                                   // .*......................................................................................................................................................
        // add    v31.4s, v31.4s, v30.4s                            // *.......................................................................................................................................................
        // rev32  v1.16b, v31.16b                                   // ..*.....................................................................................................................................................
        // add    v31.4s, v31.4s, v30.4s                            // ...*....................................................................................................................................................
        // rev32  v2.16b, v31.16b                                   // ....*...................................................................................................................................................
        // add    v31.4s, v31.4s, v30.4s                            // .....*..................................................................................................................................................
        // rev32  v3.16b, v31.16b                                   // ......*.................................................................................................................................................
        // add    v31.4s, v31.4s, v30.4s                            // .......*................................................................................................................................................
        // rev32  v20.16b, v31.16b                                  // ........*...............................................................................................................................................
        // add    v31.4s, v31.4s, v30.4s                            // .........*..............................................................................................................................................
        // rev32  v21.16b, v31.16b                                  // ..........*.............................................................................................................................................
        // add    v31.4s, v31.4s, v30.4s                            // ...........*............................................................................................................................................
        // rev32  v22.16b, v31.16b                                  // ............*...........................................................................................................................................
        // add    v31.4s, v31.4s, v30.4s                            // .............*..........................................................................................................................................
        // rev32  v23.16b, v31.16b                                  // ..............*.........................................................................................................................................
        // add    v31.4s, v31.4s, v30.4s                            // ...............*........................................................................................................................................
        // ldr q18, [x5, #((0)*16)]                                 // ................*.......................................................................................................................................
        // aesr_x4 v0.16b, v1.16b, v2.16b, v3.16b, v18.16b          // .................*......................................................................................................................................
        // aesr_x4 v20.16b, v21.16b, v22.16b, v23.16b, v18.16b      // ..................*.....................................................................................................................................
        // ldr q19, [x5, #((1)*16)]                                 // ...................*....................................................................................................................................
        // aesr_x4 v0.16b, v1.16b, v2.16b, v3.16b, v19.16b          // ....................*...................................................................................................................................
        // aesr_x4 v20.16b, v21.16b, v22.16b, v23.16b, v19.16b      // .....................*..................................................................................................................................
        // ldr q18, [x5, #((2)*16)]                                 // ......................*.................................................................................................................................
        // aesr_x4 v0.16b, v1.16b, v2.16b, v3.16b, v18.16b          // .......................*................................................................................................................................
        // aesr_x4 v20.16b, v21.16b, v22.16b, v23.16b, v18.16b      // ........................*...............................................................................................................................
        // ldr q19, [x5, #((3)*16)]                                 // .........................*..............................................................................................................................
        // aesr_x4 v0.16b, v1.16b, v2.16b, v3.16b, v19.16b          // ..........................*.............................................................................................................................
        // aesr_x4 v20.16b, v21.16b, v22.16b, v23.16b, v19.16b      // ...........................*............................................................................................................................
        // ldr q18, [x5, #((4)*16)]                                 // ............................*...........................................................................................................................
        // aesr_x4 v0.16b, v1.16b, v2.16b, v3.16b, v18.16b          // .............................*..........................................................................................................................
        // aesr_x4 v20.16b, v21.16b, v22.16b, v23.16b, v18.16b      // ..............................*.........................................................................................................................
        // ldr q19, [x5, #((5)*16)]                                 // ...............................*........................................................................................................................
        // aesr_x4 v0.16b, v1.16b, v2.16b, v3.16b, v19.16b          // ................................*.......................................................................................................................
        // aesr_x4 v20.16b, v21.16b, v22.16b, v23.16b, v19.16b      // .................................*......................................................................................................................
        // ldr q18, [x5, #((6)*16)]                                 // ..................................*.....................................................................................................................
        // aesr_x4 v0.16b, v1.16b, v2.16b, v3.16b, v18.16b          // ...................................*....................................................................................................................
        // aesr_x4 v20.16b, v21.16b, v22.16b, v23.16b, v18.16b      // ....................................*...................................................................................................................
        // ldr q19, [x5, #((7)*16)]                                 // .....................................*..................................................................................................................
        // aesr_x4 v0.16b, v1.16b, v2.16b, v3.16b, v19.16b          // ......................................*.................................................................................................................
        // aesr_x4 v20.16b, v21.16b, v22.16b, v23.16b, v19.16b      // .......................................*................................................................................................................
        // ldr q18, [x5, #((8)*16)]                                 // ........................................*...............................................................................................................
        // aesr_x4 v0.16b, v1.16b, v2.16b, v3.16b, v18.16b          // .........................................*..............................................................................................................
        // aesr_x4 v20.16b, v21.16b, v22.16b, v23.16b, v18.16b      // ..........................................*.............................................................................................................
        // ldr q19, [x5, #((9)*16)]                                 // ...........................................*............................................................................................................
        // aese_x4 v0.16b, v1.16b, v2.16b, v3.16b, v19.16b          // ............................................*...........................................................................................................
        // aese_x4 v20.16b, v21.16b, v22.16b, v23.16b, v19.16b      // .............................................*..........................................................................................................
        // ldr q18, [x5, #((10)*16)]                                // ..............................................*.........................................................................................................
        // ldp q4, q5, [x0], #(8*16)                                // ...............................................*........................................................................................................
        // eor3 v4.16b, v4.16b, v18.16b, v0.16b                     // ................................................*.......................................................................................................
        // eor3 v5.16b, v5.16b, v18.16b, v1.16b                     // .................................................*......................................................................................................
        // ldp q6, q24, [x0, #(-6*16)]                              // ..................................................*.....................................................................................................
        // eor3 v6.16b, v6.16b, v18.16b, v2.16b                     // ...................................................*....................................................................................................
        // eor3 v24.16b, v24.16b, v18.16b, v3.16b                   // ....................................................*...................................................................................................
        // ldp q25, q26, [x0, #(-4*16)]                             // .....................................................*..................................................................................................
        // eor3 v25.16b, v25.16b, v18.16b, v20.16b                  // ......................................................*.................................................................................................
        // eor3 v26.16b, v26.16b, v18.16b, v21.16b                  // .......................................................*................................................................................................
        // ldp q27, q28, [x0, #(-2*16)]                             // ........................................................*...............................................................................................
        // eor3 v27.16b, v27.16b, v18.16b, v22.16b                  // .........................................................*..............................................................................................
        // eor3 v28.16b, v28.16b, v18.16b, v23.16b                  // ..........................................................*.............................................................................................
        // stp q4, q5, [x2], #(8*16)                                // ...........................................................*............................................................................................
        // stp q6, q24, [x2, #(-6*16)]                              // ............................................................*...........................................................................................
        // stp q25, q26, [x2, #(-4*16)]                             // .............................................................*..........................................................................................
        // stp q27, q28, [x2, #(-2*16)]                             // ..............................................................*.........................................................................................
        // rev64 v4.16b, v4.16b                                     // ...............................................................*........................................................................................
        // rev64 v5.16b, v5.16b                                     // ................................................................*.......................................................................................
        // rev64 v6.16b, v6.16b                                     // .................................................................*......................................................................................
        // rev64 v24.16b, v24.16b                                   // ..................................................................*.....................................................................................
        // rev64 v25.16b, v25.16b                                   // ...................................................................*....................................................................................
        // rev64 v26.16b, v26.16b                                   // ....................................................................*...................................................................................
        // rev64 v27.16b, v27.16b                                   // .....................................................................*..................................................................................
        // rev64 v28.16b, v28.16b                                   // ......................................................................*.................................................................................
        // eor   v4.16b, v4.16b, v11.16b                            // .......................................................................*................................................................................
        // ldr q12, [x6, #144]                                      // ........................................................................*...............................................................................
        // ldr q13, [x6, #176]                                      // .........................................................................*..............................................................................
        // ldr q14, [x6, #160]                                      // ..........................................................................*.............................................................................
        // pmull   v8.1q,  v4.1d, v13.1d                            // ...........................................................................*............................................................................
        // pmull   v11.1q, v5.1d, v12.1d                            // ............................................................................*...........................................................................
        // eor     v8.16b, v8.16b, v11.16b                          // .............................................................................*..........................................................................
        // pmull2  v9.1q, v4.2d, v13.2d                             // ..............................................................................*.........................................................................
        // pmull2  v11.1q, v5.2d, v12.2d                            // ...............................................................................*........................................................................
        // eor     v9.16b, v9.16b, v11.16b                          // .................................................................................*......................................................................
        // trn1    v11.2d,  v5.2d, v4.2d                            // ................................................................................*.......................................................................
        // trn2    v5.2d, v5.2d, v4.2d                              // ..................................................................................*.....................................................................
        // eor     v11.16b, v11.16b, v5.16b                         // ...................................................................................*....................................................................
        // pmull2  v10.1q, v11.2d, v14.2d                           // ....................................................................................*...................................................................
        // pmull   v11.1q, v11.1d, v14.1d                           // .....................................................................................*..................................................................
        // eor     v10.16b, v10.16b, v11.16b                        // ......................................................................................*.................................................................
        // ldr q12, [x6, #96]                                       // .......................................................................................*................................................................
        // ldr q13, [x6, #128]                                      // ........................................................................................*...............................................................
        // ldr q14, [x6, #112]                                      // .........................................................................................*..............................................................
        // pmull   v16.1q,  v6.1d, v13.1d                           // ..........................................................................................*.............................................................
        // pmull   v11.1q, v24.1d, v12.1d                           // ...........................................................................................*............................................................
        // eor     v16.16b, v16.16b, v11.16b                        // ............................................................................................*...........................................................
        // pmull2  v15.1q, v6.2d, v13.2d                            // .............................................................................................*..........................................................
        // pmull2  v11.1q, v24.2d, v12.2d                           // ..............................................................................................*.........................................................
        // eor     v15.16b, v15.16b, v11.16b                        // ...............................................................................................*........................................................
        // trn1    v11.2d,  v24.2d, v6.2d                           // ................................................................................................*.......................................................
        // trn2    v24.2d, v24.2d, v6.2d                            // .................................................................................................*......................................................
        // eor     v11.16b, v11.16b, v24.16b                        // ..................................................................................................*.....................................................
        // pmull2  v17.1q, v11.2d, v14.2d                           // ...................................................................................................*....................................................
        // pmull   v11.1q, v11.1d, v14.1d                           // ....................................................................................................*...................................................
        // eor     v17.16b, v17.16b, v11.16b                        // .....................................................................................................*..................................................
        // ldr q12, [x6, #48]                                       // ......................................................................................................*.................................................
        // ldr q13, [x6, #80]                                       // .......................................................................................................*................................................
        // ldr q14, [x6, #64]                                       // ........................................................................................................*...............................................
        // pmull   v11.1q, v25.1d, v13.1d                           // .........................................................................................................*..............................................
        // eor     v8.16b, v8.16b, v11.16b                          // ..........................................................................................................*.............................................
        // pmull   v11.1q, v26.1d, v12.1d                           // ...........................................................................................................*............................................
        // eor     v8.16b, v8.16b, v11.16b                          // ............................................................................................................*...........................................
        // pmull2  v11.1q, v25.2d, v13.2d                           // .............................................................................................................*..........................................
        // eor     v9.16b, v9.16b, v11.16b                          // ..............................................................................................................*.........................................
        // pmull2  v11.1q, v26.2d, v12.2d                           // ...............................................................................................................*........................................
        // eor     v9.16b, v9.16b, v11.16b                          // ................................................................................................................*.......................................
        // trn1    v11.2d,  v26.2d, v25.2d                          // .................................................................................................................*......................................
        // trn2    v26.2d, v26.2d, v25.2d                           // ..................................................................................................................*.....................................
        // eor     v11.16b, v11.16b, v26.16b                        // ...................................................................................................................*....................................
        // pmull2  v25.1q, v11.2d, v14.2d                           // ....................................................................................................................*...................................
        // eor     v10.16b, v10.16b, v25.16b                        // .....................................................................................................................*..................................
        // pmull   v11.1q, v11.1d, v14.1d                           // ......................................................................................................................*.................................
        // eor     v10.16b, v10.16b, v11.16b                        // .......................................................................................................................*................................
        // ldr q12, [x6]                                            // ........................................................................................................................*...............................
        // ldr q13, [x6, #32]                                       // .........................................................................................................................*..............................
        // ldr q14, [x6, #16]                                       // ..........................................................................................................................*.............................
        // pmull   v11.1q, v27.1d, v13.1d                           // ...........................................................................................................................*............................
        // eor     v16.16b, v16.16b, v11.16b                        // ............................................................................................................................*...........................
        // pmull   v11.1q, v28.1d, v12.1d                           // .............................................................................................................................*..........................
        // eor     v16.16b, v16.16b, v11.16b                        // ................................................................................................................................*.......................
        // pmull2  v11.1q, v27.2d, v13.2d                           // ..............................................................................................................................*.........................
        // eor     v15.16b, v15.16b, v11.16b                        // ...............................................................................................................................*........................
        // pmull2  v11.1q, v28.2d, v12.2d                           // .................................................................................................................................*......................
        // eor     v15.16b, v15.16b, v11.16b                        // ..................................................................................................................................*.....................
        // trn1    v11.2d,  v28.2d, v27.2d                          // ...................................................................................................................................*....................
        // trn2    v28.2d, v28.2d, v27.2d                           // ....................................................................................................................................*...................
        // eor     v11.16b, v11.16b, v28.16b                        // .....................................................................................................................................*..................
        // pmull2  v27.1q, v11.2d, v14.2d                           // ......................................................................................................................................*.................
        // eor     v17.16b, v17.16b, v27.16b                        // ........................................................................................................................................*...............
        // pmull   v11.1q, v11.1d, v14.1d                           // .......................................................................................................................................*................
        // eor     v17.16b, v17.16b, v11.16b                        // .........................................................................................................................................*..............
        // eor v8.16b,  v8.16b,  v16.16b                            // ..........................................................................................................................................*.............
        // eor v9.16b,  v9.16b,  v15.16b                            // ...........................................................................................................................................*............
        // eor v10.16b, v10.16b, v17.16b                            // ............................................................................................................................................*...........
        // eor        v0.16b, v8.16b,  v9.16b                       // .............................................................................................................................................*..........
        // pmull      v1.1q,  v9.1d,   v7.1d                        // ..............................................................................................................................................*.........
        // ext        v9.16b,    v9.16b,  v9.16b, #8                // ...............................................................................................................................................*........
        // eor        v10.16b,   v10.16b, v0.16b                    // ................................................................................................................................................*.......
        // eor        v1.16b, v9.16b,  v1.16b                       // .................................................................................................................................................*......
        // eor        v10.16b,   v10.16b, v1.16b                    // ..................................................................................................................................................*.....
        // pmull      v9.1q,     v10.1d,  v7.1d                     // ...................................................................................................................................................*....
        // eor        v8.16b,    v8.16b,  v9.16b                    // ....................................................................................................................................................*...
        // ext        v10.16b,   v10.16b, v10.16b, #8               // .....................................................................................................................................................*..
        // eor        v11.16b,     v8.16b,  v10.16b                 // ......................................................................................................................................................*.
        // ext        v11.16b, v11.16b, v11.16b, #8                 // .......................................................................................................................................................*

        sub count, count, #1
        cbnz count, Lloop_unrolled_start
Lloop_unrolled_start_postamble:// end of loop kernel
        // Instructions:    0
        // Expected cycles: 0
        // Expected IPC:    0
        b Lloop_unrolled_start_end
Lloop_unrolled_start_end:
Lloop_unrolled_end:

        load_htable_12

        cbz remainder, Lloop_1x_end
Lloop_1x_start:

        next_ctr_init_aes aes_st0

        load_round_key 0
        aesr aes_st0.16b, rk0.16b

        load_round_key 1
        aesr aes_st0.16b, rk1.16b

        load_round_key 2
        aesr aes_st0.16b, rk2.16b

        load_round_key 3
        aesr aes_st0.16b, rk3.16b

        load_round_key 4
        aesr aes_st0.16b, rk4.16b

        load_round_key 5
        aesr aes_st0.16b, rk5.16b

        load_round_key 6
        aesr aes_st0.16b, rk6.16b

        load_round_key 7
        aesr aes_st0.16b, rk7.16b

        load_round_key 8
        aesr aes_st0.16b, rk8.16b

        load_round_key 9
        aese aes_st0.16b, rk9.16b

        load_round_key 10
        ldr plain0_q, [input], #16
        eor3 res0.16b, plain0.16b, rk10.16b, aes_st0.16b
        str res0_q, [output], #16

        ghash_init_0 res0, Ht1, Ht12, tag
        ghash_finalize tag

        sub remainder, remainder, #1
        cbnz remainder, Lloop_1x_start
Lloop_1x_end:

        // Return number of bytes processed
        mov x0, byte_len
        // Store new authentication tag
        rev64 tag.16b, tag.16b
        str tag_q, [tag_ptr]
        // Store updated counter
        rev32 rtmp_ctr.16b, rtmp_ctr.16b
        str rtmp_ctr_q, [ivec]

        restore_vregs
        restore_gprs

Lenc_postamble_end:
        add sp, sp, #STACK_SIZE

        AARCH64_VALIDATE_LINK_REGISTER
        ret

#endif
#endif  // !OPENSSL_NO_ASM && defined(__AARCH64EL__) && defined(__APPLE__)
#if defined(__ELF__)
// See https: // www.airs.com/blog/archives/518.
.section .note.GNU-stack,"",%progbits
#endif